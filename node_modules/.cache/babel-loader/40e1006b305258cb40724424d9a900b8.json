{"ast":null,"code":"import _createForOfIteratorHelper from \"/data/data/com.termux/files/home/Ionic/ExploringApp/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _regeneratorRuntime from \"/data/data/com.termux/files/home/Ionic/ExploringApp/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/data/data/com.termux/files/home/Ionic/ExploringApp/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/data/data/com.termux/files/home/Ionic/ExploringApp/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/data/data/com.termux/files/home/Ionic/ExploringApp/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"/data/data/com.termux/files/home/Ionic/ExploringApp/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _inherits from \"/data/data/com.termux/files/home/Ionic/ExploringApp/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/data/data/com.termux/files/home/Ionic/ExploringApp/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport { WebPlugin } from '@capacitor/core';\nimport { hexStringToDataView, mapToObject, webUUIDToString } from './conversion';\nimport { runWithTimeout } from './timeout';\nexport var BluetoothLeWeb = /*#__PURE__*/function (_WebPlugin) {\n  _inherits(BluetoothLeWeb, _WebPlugin);\n\n  var _super = _createSuper(BluetoothLeWeb);\n\n  function BluetoothLeWeb() {\n    var _this;\n\n    _classCallCheck(this, BluetoothLeWeb);\n\n    _this = _super.apply(this, arguments);\n    _this.deviceMap = new Map();\n    _this.discoveredDevices = new Map();\n    _this.scan = null;\n    _this.DEFAULT_CONNECTION_TIMEOUT = 10000;\n    _this.onAdvertisementReceivedCallback = _this.onAdvertisementReceived.bind(_assertThisInitialized(_this));\n    _this.onDisconnectedCallback = _this.onDisconnected.bind(_assertThisInitialized(_this));\n    _this.onCharacteristicValueChangedCallback = _this.onCharacteristicValueChanged.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(BluetoothLeWeb, [{\n    key: \"initialize\",\n    value: function () {\n      var _initialize = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var isAvailable;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(typeof navigator === 'undefined' || !navigator.bluetooth)) {\n                  _context.next = 2;\n                  break;\n                }\n\n                throw this.unavailable('Web Bluetooth API not available in this browser.');\n\n              case 2:\n                _context.next = 4;\n                return navigator.bluetooth.getAvailability();\n\n              case 4:\n                isAvailable = _context.sent;\n\n                if (isAvailable) {\n                  _context.next = 7;\n                  break;\n                }\n\n                throw this.unavailable('No Bluetooth radio available.');\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function initialize() {\n        return _initialize.apply(this, arguments);\n      }\n\n      return initialize;\n    }()\n  }, {\n    key: \"isEnabled\",\n    value: function () {\n      var _isEnabled = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", {\n                  value: true\n                });\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function isEnabled() {\n        return _isEnabled.apply(this, arguments);\n      }\n\n      return isEnabled;\n    }()\n  }, {\n    key: \"enable\",\n    value: function () {\n      var _enable = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                throw this.unavailable('enable is not available on web.');\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function enable() {\n        return _enable.apply(this, arguments);\n      }\n\n      return enable;\n    }()\n  }, {\n    key: \"disable\",\n    value: function () {\n      var _disable = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                throw this.unavailable('disable is not available on web.');\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function disable() {\n        return _disable.apply(this, arguments);\n      }\n\n      return disable;\n    }()\n  }, {\n    key: \"startEnabledNotifications\",\n    value: function () {\n      var _startEnabledNotifications = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      function startEnabledNotifications() {\n        return _startEnabledNotifications.apply(this, arguments);\n      }\n\n      return startEnabledNotifications;\n    }()\n  }, {\n    key: \"stopEnabledNotifications\",\n    value: function () {\n      var _stopEnabledNotifications = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }));\n\n      function stopEnabledNotifications() {\n        return _stopEnabledNotifications.apply(this, arguments);\n      }\n\n      return stopEnabledNotifications;\n    }()\n  }, {\n    key: \"isLocationEnabled\",\n    value: function () {\n      var _isLocationEnabled = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                throw this.unavailable('isLocationEnabled is not available on web.');\n\n              case 1:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function isLocationEnabled() {\n        return _isLocationEnabled.apply(this, arguments);\n      }\n\n      return isLocationEnabled;\n    }()\n  }, {\n    key: \"openLocationSettings\",\n    value: function () {\n      var _openLocationSettings = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {\n        return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                throw this.unavailable('openLocationSettings is not available on web.');\n\n              case 1:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n\n      function openLocationSettings() {\n        return _openLocationSettings.apply(this, arguments);\n      }\n\n      return openLocationSettings;\n    }()\n  }, {\n    key: \"openBluetoothSettings\",\n    value: function () {\n      var _openBluetoothSettings = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {\n        return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                throw this.unavailable('openBluetoothSettings is not available on web.');\n\n              case 1:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n\n      function openBluetoothSettings() {\n        return _openBluetoothSettings.apply(this, arguments);\n      }\n\n      return openBluetoothSettings;\n    }()\n  }, {\n    key: \"openAppSettings\",\n    value: function () {\n      var _openAppSettings = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10() {\n        return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                throw this.unavailable('openAppSettings is not available on web.');\n\n              case 1:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n\n      function openAppSettings() {\n        return _openAppSettings.apply(this, arguments);\n      }\n\n      return openAppSettings;\n    }()\n  }, {\n    key: \"setDisplayStrings\",\n    value: function () {\n      var _setDisplayStrings = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee11() {\n        return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11);\n      }));\n\n      function setDisplayStrings() {\n        return _setDisplayStrings.apply(this, arguments);\n      }\n\n      return setDisplayStrings;\n    }()\n  }, {\n    key: \"requestDevice\",\n    value: function () {\n      var _requestDevice = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee12(options) {\n        var filters, device, bleDevice;\n        return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                filters = this.getFilters(options);\n                _context12.next = 3;\n                return navigator.bluetooth.requestDevice({\n                  filters: filters.length ? filters : undefined,\n                  optionalServices: options === null || options === void 0 ? void 0 : options.optionalServices,\n                  acceptAllDevices: filters.length === 0\n                });\n\n              case 3:\n                device = _context12.sent;\n                this.deviceMap.set(device.id, device);\n                bleDevice = this.getBleDevice(device);\n                return _context12.abrupt(\"return\", bleDevice);\n\n              case 7:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n\n      function requestDevice(_x) {\n        return _requestDevice.apply(this, arguments);\n      }\n\n      return requestDevice;\n    }()\n  }, {\n    key: \"requestLEScan\",\n    value: function () {\n      var _requestLEScan = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee13(options) {\n        var filters;\n        return _regeneratorRuntime().wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                this.requestBleDeviceOptions = options;\n                filters = this.getFilters(options);\n                _context13.next = 4;\n                return this.stopLEScan();\n\n              case 4:\n                this.discoveredDevices = new Map();\n                navigator.bluetooth.removeEventListener('advertisementreceived', this.onAdvertisementReceivedCallback);\n                navigator.bluetooth.addEventListener('advertisementreceived', this.onAdvertisementReceivedCallback);\n                _context13.next = 9;\n                return navigator.bluetooth.requestLEScan({\n                  filters: filters.length ? filters : undefined,\n                  acceptAllAdvertisements: filters.length === 0,\n                  keepRepeatedDevices: options === null || options === void 0 ? void 0 : options.allowDuplicates\n                });\n\n              case 9:\n                this.scan = _context13.sent;\n\n              case 10:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n\n      function requestLEScan(_x2) {\n        return _requestLEScan.apply(this, arguments);\n      }\n\n      return requestLEScan;\n    }()\n  }, {\n    key: \"onAdvertisementReceived\",\n    value: function onAdvertisementReceived(event) {\n      var _a, _b;\n\n      var deviceId = event.device.id;\n      this.deviceMap.set(deviceId, event.device);\n      var isNew = !this.discoveredDevices.has(deviceId);\n\n      if (isNew || ((_a = this.requestBleDeviceOptions) === null || _a === void 0 ? void 0 : _a.allowDuplicates)) {\n        this.discoveredDevices.set(deviceId, true);\n        var device = this.getBleDevice(event.device);\n        var result = {\n          device: device,\n          localName: device.name,\n          rssi: event.rssi,\n          txPower: event.txPower,\n          manufacturerData: mapToObject(event.manufacturerData),\n          serviceData: mapToObject(event.serviceData),\n          uuids: (_b = event.uuids) === null || _b === void 0 ? void 0 : _b.map(webUUIDToString)\n        };\n        this.notifyListeners('onScanResult', result);\n      }\n    }\n  }, {\n    key: \"stopLEScan\",\n    value: function () {\n      var _stopLEScan = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee14() {\n        var _a;\n\n        return _regeneratorRuntime().wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                if ((_a = this.scan) === null || _a === void 0 ? void 0 : _a.active) {\n                  this.scan.stop();\n                }\n\n                this.scan = null;\n\n              case 2:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n\n      function stopLEScan() {\n        return _stopLEScan.apply(this, arguments);\n      }\n\n      return stopLEScan;\n    }()\n  }, {\n    key: \"getDevices\",\n    value: function () {\n      var _getDevices = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee15(_options) {\n        var _this2 = this;\n\n        var devices, bleDevices;\n        return _regeneratorRuntime().wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                _context15.next = 2;\n                return navigator.bluetooth.getDevices();\n\n              case 2:\n                devices = _context15.sent;\n                bleDevices = devices.map(function (device) {\n                  _this2.deviceMap.set(device.id, device);\n\n                  var bleDevice = _this2.getBleDevice(device);\n\n                  return bleDevice;\n                });\n                return _context15.abrupt(\"return\", {\n                  devices: bleDevices\n                });\n\n              case 5:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15);\n      }));\n\n      function getDevices(_x3) {\n        return _getDevices.apply(this, arguments);\n      }\n\n      return getDevices;\n    }()\n  }, {\n    key: \"getConnectedDevices\",\n    value: function () {\n      var _getConnectedDevices = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee16(_options) {\n        var _this3 = this;\n\n        var devices, bleDevices;\n        return _regeneratorRuntime().wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                _context16.next = 2;\n                return navigator.bluetooth.getDevices();\n\n              case 2:\n                devices = _context16.sent;\n                bleDevices = devices.filter(function (device) {\n                  var _a;\n\n                  return (_a = device.gatt) === null || _a === void 0 ? void 0 : _a.connected;\n                }).map(function (device) {\n                  _this3.deviceMap.set(device.id, device);\n\n                  var bleDevice = _this3.getBleDevice(device);\n\n                  return bleDevice;\n                });\n                return _context16.abrupt(\"return\", {\n                  devices: bleDevices\n                });\n\n              case 5:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16);\n      }));\n\n      function getConnectedDevices(_x4) {\n        return _getConnectedDevices.apply(this, arguments);\n      }\n\n      return getConnectedDevices;\n    }()\n  }, {\n    key: \"connect\",\n    value: function () {\n      var _connect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee17(options) {\n        var _a, _b, device, timeoutError, timeout;\n\n        return _regeneratorRuntime().wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                device = this.getDeviceFromMap(options.deviceId);\n                device.removeEventListener('gattserverdisconnected', this.onDisconnectedCallback);\n                device.addEventListener('gattserverdisconnected', this.onDisconnectedCallback);\n                timeoutError = Symbol();\n\n                if (!(device.gatt === undefined)) {\n                  _context17.next = 6;\n                  break;\n                }\n\n                throw new Error('No gatt server available.');\n\n              case 6:\n                _context17.prev = 6;\n                timeout = (_a = options.timeout) !== null && _a !== void 0 ? _a : this.DEFAULT_CONNECTION_TIMEOUT;\n                _context17.next = 10;\n                return runWithTimeout(device.gatt.connect(), timeout, timeoutError);\n\n              case 10:\n                _context17.next = 21;\n                break;\n\n              case 12:\n                _context17.prev = 12;\n                _context17.t0 = _context17[\"catch\"](6);\n                _context17.next = 16;\n                return (_b = device.gatt) === null || _b === void 0 ? void 0 : _b.disconnect();\n\n              case 16:\n                if (!(_context17.t0 === timeoutError)) {\n                  _context17.next = 20;\n                  break;\n                }\n\n                throw new Error('Connection timeout');\n\n              case 20:\n                throw _context17.t0;\n\n              case 21:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this, [[6, 12]]);\n      }));\n\n      function connect(_x5) {\n        return _connect.apply(this, arguments);\n      }\n\n      return connect;\n    }()\n  }, {\n    key: \"onDisconnected\",\n    value: function onDisconnected(event) {\n      var deviceId = event.target.id;\n      var key = \"disconnected|\".concat(deviceId);\n      this.notifyListeners(key, null);\n    }\n  }, {\n    key: \"createBond\",\n    value: function () {\n      var _createBond = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee18(_options) {\n        return _regeneratorRuntime().wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                throw this.unavailable('createBond is not available on web.');\n\n              case 1:\n              case \"end\":\n                return _context18.stop();\n            }\n          }\n        }, _callee18, this);\n      }));\n\n      function createBond(_x6) {\n        return _createBond.apply(this, arguments);\n      }\n\n      return createBond;\n    }()\n  }, {\n    key: \"isBonded\",\n    value: function () {\n      var _isBonded = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee19(_options) {\n        return _regeneratorRuntime().wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                throw this.unavailable('isBonded is not available on web.');\n\n              case 1:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19, this);\n      }));\n\n      function isBonded(_x7) {\n        return _isBonded.apply(this, arguments);\n      }\n\n      return isBonded;\n    }()\n  }, {\n    key: \"disconnect\",\n    value: function () {\n      var _disconnect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee20(options) {\n        var _a;\n\n        return _regeneratorRuntime().wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                (_a = this.getDeviceFromMap(options.deviceId).gatt) === null || _a === void 0 ? void 0 : _a.disconnect();\n\n              case 1:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20, this);\n      }));\n\n      function disconnect(_x8) {\n        return _disconnect.apply(this, arguments);\n      }\n\n      return disconnect;\n    }()\n  }, {\n    key: \"getServices\",\n    value: function () {\n      var _getServices = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee21(options) {\n        var _a, _b, services, bleServices, _iterator, _step, service, characteristics, bleCharacteristics, _iterator2, _step2, characteristic;\n\n        return _regeneratorRuntime().wrap(function _callee21$(_context21) {\n          while (1) {\n            switch (_context21.prev = _context21.next) {\n              case 0:\n                _context21.next = 2;\n                return (_a = this.getDeviceFromMap(options.deviceId).gatt) === null || _a === void 0 ? void 0 : _a.getPrimaryServices();\n\n              case 2:\n                _context21.t1 = _b = _context21.sent;\n                _context21.t0 = _context21.t1 !== null;\n\n                if (!_context21.t0) {\n                  _context21.next = 6;\n                  break;\n                }\n\n                _context21.t0 = _b !== void 0;\n\n              case 6:\n                if (!_context21.t0) {\n                  _context21.next = 10;\n                  break;\n                }\n\n                _context21.t2 = _b;\n                _context21.next = 11;\n                break;\n\n              case 10:\n                _context21.t2 = [];\n\n              case 11:\n                services = _context21.t2;\n                bleServices = [];\n                _iterator = _createForOfIteratorHelper(services);\n                _context21.prev = 14;\n\n                _iterator.s();\n\n              case 16:\n                if ((_step = _iterator.n()).done) {\n                  _context21.next = 48;\n                  break;\n                }\n\n                service = _step.value;\n                _context21.next = 20;\n                return service.getCharacteristics();\n\n              case 20:\n                characteristics = _context21.sent;\n                bleCharacteristics = [];\n                _iterator2 = _createForOfIteratorHelper(characteristics);\n                _context21.prev = 23;\n\n                _iterator2.s();\n\n              case 25:\n                if ((_step2 = _iterator2.n()).done) {\n                  _context21.next = 37;\n                  break;\n                }\n\n                characteristic = _step2.value;\n                _context21.t3 = bleCharacteristics;\n                _context21.t4 = characteristic.uuid;\n                _context21.t5 = this.getProperties(characteristic);\n                _context21.next = 32;\n                return this.getDescriptors(characteristic);\n\n              case 32:\n                _context21.t6 = _context21.sent;\n                _context21.t7 = {\n                  uuid: _context21.t4,\n                  properties: _context21.t5,\n                  descriptors: _context21.t6\n                };\n\n                _context21.t3.push.call(_context21.t3, _context21.t7);\n\n              case 35:\n                _context21.next = 25;\n                break;\n\n              case 37:\n                _context21.next = 42;\n                break;\n\n              case 39:\n                _context21.prev = 39;\n                _context21.t8 = _context21[\"catch\"](23);\n\n                _iterator2.e(_context21.t8);\n\n              case 42:\n                _context21.prev = 42;\n\n                _iterator2.f();\n\n                return _context21.finish(42);\n\n              case 45:\n                bleServices.push({\n                  uuid: service.uuid,\n                  characteristics: bleCharacteristics\n                });\n\n              case 46:\n                _context21.next = 16;\n                break;\n\n              case 48:\n                _context21.next = 53;\n                break;\n\n              case 50:\n                _context21.prev = 50;\n                _context21.t9 = _context21[\"catch\"](14);\n\n                _iterator.e(_context21.t9);\n\n              case 53:\n                _context21.prev = 53;\n\n                _iterator.f();\n\n                return _context21.finish(53);\n\n              case 56:\n                return _context21.abrupt(\"return\", {\n                  services: bleServices\n                });\n\n              case 57:\n              case \"end\":\n                return _context21.stop();\n            }\n          }\n        }, _callee21, this, [[14, 50, 53, 56], [23, 39, 42, 45]]);\n      }));\n\n      function getServices(_x9) {\n        return _getServices.apply(this, arguments);\n      }\n\n      return getServices;\n    }()\n  }, {\n    key: \"getDescriptors\",\n    value: function () {\n      var _getDescriptors = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee22(characteristic) {\n        var descriptors;\n        return _regeneratorRuntime().wrap(function _callee22$(_context22) {\n          while (1) {\n            switch (_context22.prev = _context22.next) {\n              case 0:\n                _context22.prev = 0;\n                _context22.next = 3;\n                return characteristic.getDescriptors();\n\n              case 3:\n                descriptors = _context22.sent;\n                return _context22.abrupt(\"return\", descriptors.map(function (descriptor) {\n                  return {\n                    uuid: descriptor.uuid\n                  };\n                }));\n\n              case 7:\n                _context22.prev = 7;\n                _context22.t0 = _context22[\"catch\"](0);\n                return _context22.abrupt(\"return\", []);\n\n              case 10:\n              case \"end\":\n                return _context22.stop();\n            }\n          }\n        }, _callee22, null, [[0, 7]]);\n      }));\n\n      function getDescriptors(_x10) {\n        return _getDescriptors.apply(this, arguments);\n      }\n\n      return getDescriptors;\n    }()\n  }, {\n    key: \"getProperties\",\n    value: function getProperties(characteristic) {\n      return {\n        broadcast: characteristic.properties.broadcast,\n        read: characteristic.properties.read,\n        writeWithoutResponse: characteristic.properties.writeWithoutResponse,\n        write: characteristic.properties.write,\n        notify: characteristic.properties.notify,\n        indicate: characteristic.properties.indicate,\n        authenticatedSignedWrites: characteristic.properties.authenticatedSignedWrites,\n        reliableWrite: characteristic.properties.reliableWrite,\n        writableAuxiliaries: characteristic.properties.writableAuxiliaries\n      };\n    }\n  }, {\n    key: \"getCharacteristic\",\n    value: function () {\n      var _getCharacteristic = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee23(options) {\n        var _a, service;\n\n        return _regeneratorRuntime().wrap(function _callee23$(_context23) {\n          while (1) {\n            switch (_context23.prev = _context23.next) {\n              case 0:\n                _context23.next = 2;\n                return (_a = this.getDeviceFromMap(options.deviceId).gatt) === null || _a === void 0 ? void 0 : _a.getPrimaryService(options === null || options === void 0 ? void 0 : options.service);\n\n              case 2:\n                service = _context23.sent;\n                return _context23.abrupt(\"return\", service === null || service === void 0 ? void 0 : service.getCharacteristic(options === null || options === void 0 ? void 0 : options.characteristic));\n\n              case 4:\n              case \"end\":\n                return _context23.stop();\n            }\n          }\n        }, _callee23, this);\n      }));\n\n      function getCharacteristic(_x11) {\n        return _getCharacteristic.apply(this, arguments);\n      }\n\n      return getCharacteristic;\n    }()\n  }, {\n    key: \"getDescriptor\",\n    value: function () {\n      var _getDescriptor = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee24(options) {\n        var characteristic;\n        return _regeneratorRuntime().wrap(function _callee24$(_context24) {\n          while (1) {\n            switch (_context24.prev = _context24.next) {\n              case 0:\n                _context24.next = 2;\n                return this.getCharacteristic(options);\n\n              case 2:\n                characteristic = _context24.sent;\n                return _context24.abrupt(\"return\", characteristic === null || characteristic === void 0 ? void 0 : characteristic.getDescriptor(options === null || options === void 0 ? void 0 : options.descriptor));\n\n              case 4:\n              case \"end\":\n                return _context24.stop();\n            }\n          }\n        }, _callee24, this);\n      }));\n\n      function getDescriptor(_x12) {\n        return _getDescriptor.apply(this, arguments);\n      }\n\n      return getDescriptor;\n    }()\n  }, {\n    key: \"readRssi\",\n    value: function () {\n      var _readRssi = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee25(_options) {\n        return _regeneratorRuntime().wrap(function _callee25$(_context25) {\n          while (1) {\n            switch (_context25.prev = _context25.next) {\n              case 0:\n                throw this.unavailable('readRssi is not available on web.');\n\n              case 1:\n              case \"end\":\n                return _context25.stop();\n            }\n          }\n        }, _callee25, this);\n      }));\n\n      function readRssi(_x13) {\n        return _readRssi.apply(this, arguments);\n      }\n\n      return readRssi;\n    }()\n  }, {\n    key: \"read\",\n    value: function () {\n      var _read = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee26(options) {\n        var characteristic, value;\n        return _regeneratorRuntime().wrap(function _callee26$(_context26) {\n          while (1) {\n            switch (_context26.prev = _context26.next) {\n              case 0:\n                _context26.next = 2;\n                return this.getCharacteristic(options);\n\n              case 2:\n                characteristic = _context26.sent;\n                _context26.next = 5;\n                return characteristic === null || characteristic === void 0 ? void 0 : characteristic.readValue();\n\n              case 5:\n                value = _context26.sent;\n                return _context26.abrupt(\"return\", {\n                  value: value\n                });\n\n              case 7:\n              case \"end\":\n                return _context26.stop();\n            }\n          }\n        }, _callee26, this);\n      }));\n\n      function read(_x14) {\n        return _read.apply(this, arguments);\n      }\n\n      return read;\n    }()\n  }, {\n    key: \"write\",\n    value: function () {\n      var _write = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee27(options) {\n        var characteristic, dataView;\n        return _regeneratorRuntime().wrap(function _callee27$(_context27) {\n          while (1) {\n            switch (_context27.prev = _context27.next) {\n              case 0:\n                _context27.next = 2;\n                return this.getCharacteristic(options);\n\n              case 2:\n                characteristic = _context27.sent;\n\n                if (typeof options.value === 'string') {\n                  dataView = hexStringToDataView(options.value);\n                } else {\n                  dataView = options.value;\n                }\n\n                _context27.next = 6;\n                return characteristic === null || characteristic === void 0 ? void 0 : characteristic.writeValueWithResponse(dataView);\n\n              case 6:\n              case \"end\":\n                return _context27.stop();\n            }\n          }\n        }, _callee27, this);\n      }));\n\n      function write(_x15) {\n        return _write.apply(this, arguments);\n      }\n\n      return write;\n    }()\n  }, {\n    key: \"writeWithoutResponse\",\n    value: function () {\n      var _writeWithoutResponse = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee28(options) {\n        var characteristic, dataView;\n        return _regeneratorRuntime().wrap(function _callee28$(_context28) {\n          while (1) {\n            switch (_context28.prev = _context28.next) {\n              case 0:\n                _context28.next = 2;\n                return this.getCharacteristic(options);\n\n              case 2:\n                characteristic = _context28.sent;\n\n                if (typeof options.value === 'string') {\n                  dataView = hexStringToDataView(options.value);\n                } else {\n                  dataView = options.value;\n                }\n\n                _context28.next = 6;\n                return characteristic === null || characteristic === void 0 ? void 0 : characteristic.writeValueWithoutResponse(dataView);\n\n              case 6:\n              case \"end\":\n                return _context28.stop();\n            }\n          }\n        }, _callee28, this);\n      }));\n\n      function writeWithoutResponse(_x16) {\n        return _writeWithoutResponse.apply(this, arguments);\n      }\n\n      return writeWithoutResponse;\n    }()\n  }, {\n    key: \"readDescriptor\",\n    value: function () {\n      var _readDescriptor = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee29(options) {\n        var descriptor, value;\n        return _regeneratorRuntime().wrap(function _callee29$(_context29) {\n          while (1) {\n            switch (_context29.prev = _context29.next) {\n              case 0:\n                _context29.next = 2;\n                return this.getDescriptor(options);\n\n              case 2:\n                descriptor = _context29.sent;\n                _context29.next = 5;\n                return descriptor === null || descriptor === void 0 ? void 0 : descriptor.readValue();\n\n              case 5:\n                value = _context29.sent;\n                return _context29.abrupt(\"return\", {\n                  value: value\n                });\n\n              case 7:\n              case \"end\":\n                return _context29.stop();\n            }\n          }\n        }, _callee29, this);\n      }));\n\n      function readDescriptor(_x17) {\n        return _readDescriptor.apply(this, arguments);\n      }\n\n      return readDescriptor;\n    }()\n  }, {\n    key: \"writeDescriptor\",\n    value: function () {\n      var _writeDescriptor = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee30(options) {\n        var descriptor, dataView;\n        return _regeneratorRuntime().wrap(function _callee30$(_context30) {\n          while (1) {\n            switch (_context30.prev = _context30.next) {\n              case 0:\n                _context30.next = 2;\n                return this.getDescriptor(options);\n\n              case 2:\n                descriptor = _context30.sent;\n\n                if (typeof options.value === 'string') {\n                  dataView = hexStringToDataView(options.value);\n                } else {\n                  dataView = options.value;\n                }\n\n                _context30.next = 6;\n                return descriptor === null || descriptor === void 0 ? void 0 : descriptor.writeValue(dataView);\n\n              case 6:\n              case \"end\":\n                return _context30.stop();\n            }\n          }\n        }, _callee30, this);\n      }));\n\n      function writeDescriptor(_x18) {\n        return _writeDescriptor.apply(this, arguments);\n      }\n\n      return writeDescriptor;\n    }()\n  }, {\n    key: \"startNotifications\",\n    value: function () {\n      var _startNotifications = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee31(options) {\n        var characteristic;\n        return _regeneratorRuntime().wrap(function _callee31$(_context31) {\n          while (1) {\n            switch (_context31.prev = _context31.next) {\n              case 0:\n                _context31.next = 2;\n                return this.getCharacteristic(options);\n\n              case 2:\n                characteristic = _context31.sent;\n                characteristic === null || characteristic === void 0 ? void 0 : characteristic.removeEventListener('characteristicvaluechanged', this.onCharacteristicValueChangedCallback);\n                characteristic === null || characteristic === void 0 ? void 0 : characteristic.addEventListener('characteristicvaluechanged', this.onCharacteristicValueChangedCallback);\n                _context31.next = 7;\n                return characteristic === null || characteristic === void 0 ? void 0 : characteristic.startNotifications();\n\n              case 7:\n              case \"end\":\n                return _context31.stop();\n            }\n          }\n        }, _callee31, this);\n      }));\n\n      function startNotifications(_x19) {\n        return _startNotifications.apply(this, arguments);\n      }\n\n      return startNotifications;\n    }()\n  }, {\n    key: \"onCharacteristicValueChanged\",\n    value: function onCharacteristicValueChanged(event) {\n      var _a, _b;\n\n      var characteristic = event.target;\n      var key = \"notification|\".concat((_a = characteristic.service) === null || _a === void 0 ? void 0 : _a.device.id, \"|\").concat((_b = characteristic.service) === null || _b === void 0 ? void 0 : _b.uuid, \"|\").concat(characteristic.uuid);\n      this.notifyListeners(key, {\n        value: characteristic.value\n      });\n    }\n  }, {\n    key: \"stopNotifications\",\n    value: function () {\n      var _stopNotifications = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee32(options) {\n        var characteristic;\n        return _regeneratorRuntime().wrap(function _callee32$(_context32) {\n          while (1) {\n            switch (_context32.prev = _context32.next) {\n              case 0:\n                _context32.next = 2;\n                return this.getCharacteristic(options);\n\n              case 2:\n                characteristic = _context32.sent;\n                _context32.next = 5;\n                return characteristic === null || characteristic === void 0 ? void 0 : characteristic.stopNotifications();\n\n              case 5:\n              case \"end\":\n                return _context32.stop();\n            }\n          }\n        }, _callee32, this);\n      }));\n\n      function stopNotifications(_x20) {\n        return _stopNotifications.apply(this, arguments);\n      }\n\n      return stopNotifications;\n    }()\n  }, {\n    key: \"getFilters\",\n    value: function getFilters(options) {\n      var _a;\n\n      var filters = [];\n\n      var _iterator3 = _createForOfIteratorHelper((_a = options === null || options === void 0 ? void 0 : options.services) !== null && _a !== void 0 ? _a : []),\n          _step3;\n\n      try {\n        for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n          var service = _step3.value;\n          filters.push({\n            services: [service],\n            name: options === null || options === void 0 ? void 0 : options.name,\n            namePrefix: options === null || options === void 0 ? void 0 : options.namePrefix\n          });\n        }\n      } catch (err) {\n        _iterator3.e(err);\n      } finally {\n        _iterator3.f();\n      }\n\n      if (((options === null || options === void 0 ? void 0 : options.name) || (options === null || options === void 0 ? void 0 : options.namePrefix)) && filters.length === 0) {\n        filters.push({\n          name: options.name,\n          namePrefix: options.namePrefix\n        });\n      }\n\n      return filters;\n    }\n  }, {\n    key: \"getDeviceFromMap\",\n    value: function getDeviceFromMap(deviceId) {\n      var device = this.deviceMap.get(deviceId);\n\n      if (device === undefined) {\n        throw new Error('Device not found. Call \"requestDevice\", \"requestLEScan\" or \"getDevices\" first.');\n      }\n\n      return device;\n    }\n  }, {\n    key: \"getBleDevice\",\n    value: function getBleDevice(device) {\n      var _a;\n\n      var bleDevice = {\n        deviceId: device.id,\n        // use undefined instead of null if name is not available\n        name: (_a = device.name) !== null && _a !== void 0 ? _a : undefined,\n        uuids: device.uuids\n      };\n      return bleDevice;\n    }\n  }]);\n\n  return BluetoothLeWeb;\n}(WebPlugin);","map":{"version":3,"mappings":"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","names":["WebPlugin","hexStringToDataView","mapToObject","webUUIDToString","runWithTimeout","BluetoothLeWeb","Map","onAdvertisementReceived","bind","onDisconnected","onCharacteristicValueChanged","navigator","bluetooth","unavailable","getAvailability","isAvailable","value","options","filters","getFilters","requestDevice","length","undefined","optionalServices","acceptAllDevices","device","deviceMap","set","id","bleDevice","getBleDevice","requestBleDeviceOptions","stopLEScan","discoveredDevices","removeEventListener","onAdvertisementReceivedCallback","addEventListener","requestLEScan","acceptAllAdvertisements","keepRepeatedDevices","allowDuplicates","scan","event","deviceId","isNew","has","_a","result","localName","name","rssi","txPower","manufacturerData","serviceData","uuids","_b","map","notifyListeners","active","stop","_options","getDevices","devices","bleDevices","filter","gatt","connected","getDeviceFromMap","onDisconnectedCallback","timeoutError","Symbol","Error","timeout","DEFAULT_CONNECTION_TIMEOUT","connect","disconnect","target","key","getPrimaryServices","services","bleServices","service","getCharacteristics","characteristics","bleCharacteristics","characteristic","uuid","getProperties","getDescriptors","properties","descriptors","push","descriptor","broadcast","read","writeWithoutResponse","write","notify","indicate","authenticatedSignedWrites","reliableWrite","writableAuxiliaries","getPrimaryService","getCharacteristic","getDescriptor","readValue","dataView","writeValueWithResponse","writeValueWithoutResponse","writeValue","onCharacteristicValueChangedCallback","startNotifications","stopNotifications","namePrefix","get"],"sources":["/data/data/com.termux/files/home/Ionic/ExploringApp/node_modules/@capacitor-community/bluetooth-le/src/web.ts"],"sourcesContent":["import { WebPlugin } from '@capacitor/core';\n\nimport { hexStringToDataView, mapToObject, webUUIDToString } from './conversion';\nimport type {\n  BleCharacteristic,\n  BleCharacteristicProperties,\n  BleDescriptor,\n  BleService,\n  TimeoutOptions,\n  BleDevice,\n  BleServices,\n  BluetoothLePlugin,\n  BooleanResult,\n  DeviceIdOptions,\n  GetConnectedDevicesOptions,\n  GetDevicesOptions,\n  GetDevicesResult,\n  ReadDescriptorOptions,\n  ReadOptions,\n  ReadResult,\n  ReadRssiResult,\n  RequestBleDeviceOptions,\n  ScanResultInternal,\n  WriteOptions,\n  WriteDescriptorOptions,\n} from './definitions';\nimport { runWithTimeout } from './timeout';\n\nexport class BluetoothLeWeb extends WebPlugin implements BluetoothLePlugin {\n  private deviceMap = new Map<string, BluetoothDevice>();\n  private discoveredDevices = new Map<string, boolean>();\n  private scan: BluetoothLEScan | null = null;\n  private requestBleDeviceOptions: RequestBleDeviceOptions | undefined;\n  private DEFAULT_CONNECTION_TIMEOUT = 10000;\n\n  async initialize(): Promise<void> {\n    if (typeof navigator === 'undefined' || !navigator.bluetooth) {\n      throw this.unavailable('Web Bluetooth API not available in this browser.');\n    }\n    const isAvailable = await navigator.bluetooth.getAvailability();\n    if (!isAvailable) {\n      throw this.unavailable('No Bluetooth radio available.');\n    }\n  }\n\n  async isEnabled(): Promise<BooleanResult> {\n    // not available on web\n    return { value: true };\n  }\n\n  async enable(): Promise<void> {\n    throw this.unavailable('enable is not available on web.');\n  }\n\n  async disable(): Promise<void> {\n    throw this.unavailable('disable is not available on web.');\n  }\n\n  async startEnabledNotifications(): Promise<void> {\n    // not available on web\n  }\n\n  async stopEnabledNotifications(): Promise<void> {\n    // not available on web\n  }\n\n  async isLocationEnabled(): Promise<BooleanResult> {\n    throw this.unavailable('isLocationEnabled is not available on web.');\n  }\n\n  async openLocationSettings(): Promise<void> {\n    throw this.unavailable('openLocationSettings is not available on web.');\n  }\n\n  async openBluetoothSettings(): Promise<void> {\n    throw this.unavailable('openBluetoothSettings is not available on web.');\n  }\n\n  async openAppSettings(): Promise<void> {\n    throw this.unavailable('openAppSettings is not available on web.');\n  }\n\n  async setDisplayStrings(): Promise<void> {\n    // not available on web\n  }\n\n  async requestDevice(options?: RequestBleDeviceOptions): Promise<BleDevice> {\n    const filters = this.getFilters(options);\n    const device = await navigator.bluetooth.requestDevice({\n      filters: filters.length ? filters : undefined,\n      optionalServices: options?.optionalServices,\n      acceptAllDevices: filters.length === 0,\n    });\n    this.deviceMap.set(device.id, device);\n    const bleDevice = this.getBleDevice(device);\n    return bleDevice;\n  }\n\n  async requestLEScan(options?: RequestBleDeviceOptions): Promise<void> {\n    this.requestBleDeviceOptions = options;\n    const filters = this.getFilters(options);\n    await this.stopLEScan();\n    this.discoveredDevices = new Map<string, boolean>();\n    navigator.bluetooth.removeEventListener(\n      'advertisementreceived',\n      this.onAdvertisementReceivedCallback as EventListener\n    );\n    navigator.bluetooth.addEventListener('advertisementreceived', this.onAdvertisementReceivedCallback);\n    this.scan = await navigator.bluetooth.requestLEScan({\n      filters: filters.length ? filters : undefined,\n      acceptAllAdvertisements: filters.length === 0,\n      keepRepeatedDevices: options?.allowDuplicates,\n    });\n  }\n\n  private onAdvertisementReceivedCallback = this.onAdvertisementReceived.bind(this);\n\n  private onAdvertisementReceived(event: BluetoothAdvertisingEvent): void {\n    const deviceId = event.device.id;\n    this.deviceMap.set(deviceId, event.device);\n    const isNew = !this.discoveredDevices.has(deviceId);\n    if (isNew || this.requestBleDeviceOptions?.allowDuplicates) {\n      this.discoveredDevices.set(deviceId, true);\n      const device = this.getBleDevice(event.device);\n      const result: ScanResultInternal = {\n        device,\n        localName: device.name,\n        rssi: event.rssi,\n        txPower: event.txPower,\n        manufacturerData: mapToObject(event.manufacturerData),\n        serviceData: mapToObject(event.serviceData),\n        uuids: event.uuids?.map(webUUIDToString),\n      };\n      this.notifyListeners('onScanResult', result);\n    }\n  }\n\n  async stopLEScan(): Promise<void> {\n    if (this.scan?.active) {\n      this.scan.stop();\n    }\n    this.scan = null;\n  }\n\n  async getDevices(_options: GetDevicesOptions): Promise<GetDevicesResult> {\n    const devices = await navigator.bluetooth.getDevices();\n    const bleDevices = devices.map((device) => {\n      this.deviceMap.set(device.id, device);\n      const bleDevice = this.getBleDevice(device);\n      return bleDevice;\n    });\n    return { devices: bleDevices };\n  }\n\n  async getConnectedDevices(_options: GetConnectedDevicesOptions): Promise<GetDevicesResult> {\n    const devices = await navigator.bluetooth.getDevices();\n    const bleDevices = devices\n      .filter((device) => {\n        return device.gatt?.connected;\n      })\n      .map((device) => {\n        this.deviceMap.set(device.id, device);\n        const bleDevice = this.getBleDevice(device);\n        return bleDevice;\n      });\n    return { devices: bleDevices };\n  }\n\n  async connect(options: DeviceIdOptions & TimeoutOptions): Promise<void> {\n    const device = this.getDeviceFromMap(options.deviceId);\n    device.removeEventListener('gattserverdisconnected', this.onDisconnectedCallback);\n    device.addEventListener('gattserverdisconnected', this.onDisconnectedCallback);\n    const timeoutError = Symbol();\n    if (device.gatt === undefined) {\n      throw new Error('No gatt server available.');\n    }\n    try {\n      const timeout = options.timeout ?? this.DEFAULT_CONNECTION_TIMEOUT;\n      await runWithTimeout(device.gatt.connect(), timeout, timeoutError);\n    } catch (error) {\n      // cancel pending connect call, does not work yet in chromium because of a bug:\n      // https://bugs.chromium.org/p/chromium/issues/detail?id=684073\n      await device.gatt?.disconnect();\n      if (error === timeoutError) {\n        throw new Error('Connection timeout');\n      } else {\n        throw error;\n      }\n    }\n  }\n\n  private onDisconnectedCallback = this.onDisconnected.bind(this);\n\n  private onDisconnected(event: Event): void {\n    const deviceId = (event.target as BluetoothDevice).id;\n    const key = `disconnected|${deviceId}`;\n    this.notifyListeners(key, null);\n  }\n\n  async createBond(_options: DeviceIdOptions): Promise<void> {\n    throw this.unavailable('createBond is not available on web.');\n  }\n\n  async isBonded(_options: DeviceIdOptions): Promise<BooleanResult> {\n    throw this.unavailable('isBonded is not available on web.');\n  }\n\n  async disconnect(options: DeviceIdOptions): Promise<void> {\n    this.getDeviceFromMap(options.deviceId).gatt?.disconnect();\n  }\n\n  async getServices(options: DeviceIdOptions): Promise<BleServices> {\n    const services = (await this.getDeviceFromMap(options.deviceId).gatt?.getPrimaryServices()) ?? [];\n    const bleServices: BleService[] = [];\n    for (const service of services) {\n      const characteristics = await service.getCharacteristics();\n      const bleCharacteristics: BleCharacteristic[] = [];\n      for (const characteristic of characteristics) {\n        bleCharacteristics.push({\n          uuid: characteristic.uuid,\n          properties: this.getProperties(characteristic),\n          descriptors: await this.getDescriptors(characteristic),\n        });\n      }\n      bleServices.push({ uuid: service.uuid, characteristics: bleCharacteristics });\n    }\n    return { services: bleServices };\n  }\n\n  private async getDescriptors(characteristic: BluetoothRemoteGATTCharacteristic): Promise<BleDescriptor[]> {\n    try {\n      const descriptors = await characteristic.getDescriptors();\n      return descriptors.map((descriptor) => ({\n        uuid: descriptor.uuid,\n      }));\n    } catch {\n      return [];\n    }\n  }\n\n  private getProperties(characteristic: BluetoothRemoteGATTCharacteristic): BleCharacteristicProperties {\n    return {\n      broadcast: characteristic.properties.broadcast,\n      read: characteristic.properties.read,\n      writeWithoutResponse: characteristic.properties.writeWithoutResponse,\n      write: characteristic.properties.write,\n      notify: characteristic.properties.notify,\n      indicate: characteristic.properties.indicate,\n      authenticatedSignedWrites: characteristic.properties.authenticatedSignedWrites,\n      reliableWrite: characteristic.properties.reliableWrite,\n      writableAuxiliaries: characteristic.properties.writableAuxiliaries,\n    };\n  }\n\n  private async getCharacteristic(\n    options: ReadOptions | WriteOptions\n  ): Promise<BluetoothRemoteGATTCharacteristic | undefined> {\n    const service = await this.getDeviceFromMap(options.deviceId).gatt?.getPrimaryService(options?.service);\n    return service?.getCharacteristic(options?.characteristic);\n  }\n\n  private async getDescriptor(\n    options: ReadDescriptorOptions | WriteDescriptorOptions\n  ): Promise<BluetoothRemoteGATTDescriptor | undefined> {\n    const characteristic = await this.getCharacteristic(options);\n    return characteristic?.getDescriptor(options?.descriptor);\n  }\n\n  async readRssi(_options: DeviceIdOptions): Promise<ReadRssiResult> {\n    throw this.unavailable('readRssi is not available on web.');\n  }\n\n  async read(options: ReadOptions): Promise<ReadResult> {\n    const characteristic = await this.getCharacteristic(options);\n    const value = await characteristic?.readValue();\n    return { value };\n  }\n\n  async write(options: WriteOptions): Promise<void> {\n    const characteristic = await this.getCharacteristic(options);\n    let dataView: DataView;\n    if (typeof options.value === 'string') {\n      dataView = hexStringToDataView(options.value);\n    } else {\n      dataView = options.value;\n    }\n    await characteristic?.writeValueWithResponse(dataView);\n  }\n\n  async writeWithoutResponse(options: WriteOptions): Promise<void> {\n    const characteristic = await this.getCharacteristic(options);\n    let dataView: DataView;\n    if (typeof options.value === 'string') {\n      dataView = hexStringToDataView(options.value);\n    } else {\n      dataView = options.value;\n    }\n    await characteristic?.writeValueWithoutResponse(dataView);\n  }\n\n  async readDescriptor(options: ReadDescriptorOptions): Promise<ReadResult> {\n    const descriptor = await this.getDescriptor(options);\n    const value = await descriptor?.readValue();\n    return { value };\n  }\n\n  async writeDescriptor(options: WriteDescriptorOptions): Promise<void> {\n    const descriptor = await this.getDescriptor(options);\n    let dataView: DataView;\n    if (typeof options.value === 'string') {\n      dataView = hexStringToDataView(options.value);\n    } else {\n      dataView = options.value;\n    }\n    await descriptor?.writeValue(dataView);\n  }\n\n  async startNotifications(options: ReadOptions): Promise<void> {\n    const characteristic = await this.getCharacteristic(options);\n    characteristic?.removeEventListener('characteristicvaluechanged', this.onCharacteristicValueChangedCallback);\n    characteristic?.addEventListener('characteristicvaluechanged', this.onCharacteristicValueChangedCallback);\n    await characteristic?.startNotifications();\n  }\n\n  private onCharacteristicValueChangedCallback = this.onCharacteristicValueChanged.bind(this);\n\n  private onCharacteristicValueChanged(event: Event): void {\n    const characteristic = event.target as BluetoothRemoteGATTCharacteristic;\n    const key = `notification|${characteristic.service?.device.id}|${characteristic.service?.uuid}|${characteristic.uuid}`;\n    this.notifyListeners(key, {\n      value: characteristic.value,\n    });\n  }\n\n  async stopNotifications(options: ReadOptions): Promise<void> {\n    const characteristic = await this.getCharacteristic(options);\n    await characteristic?.stopNotifications();\n  }\n\n  private getFilters(options?: RequestBleDeviceOptions): BluetoothLEScanFilter[] {\n    const filters: BluetoothLEScanFilter[] = [];\n    for (const service of options?.services ?? []) {\n      filters.push({\n        services: [service],\n        name: options?.name,\n        namePrefix: options?.namePrefix,\n      });\n    }\n    if ((options?.name || options?.namePrefix) && filters.length === 0) {\n      filters.push({\n        name: options.name,\n        namePrefix: options.namePrefix,\n      });\n    }\n    return filters;\n  }\n\n  private getDeviceFromMap(deviceId: string): BluetoothDevice {\n    const device = this.deviceMap.get(deviceId);\n    if (device === undefined) {\n      throw new Error('Device not found. Call \"requestDevice\", \"requestLEScan\" or \"getDevices\" first.');\n    }\n    return device;\n  }\n\n  private getBleDevice(device: BluetoothDevice): BleDevice {\n    const bleDevice: BleDevice = {\n      deviceId: device.id,\n      // use undefined instead of null if name is not available\n      name: device.name ?? undefined,\n      uuids: device.uuids,\n    };\n    return bleDevice;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}